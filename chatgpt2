import pygame
import math

# Inicialização
pygame.init()

# Tela
WIDTH, HEIGHT = 800, 600
screen = pygame.display.set_mode((WIDTH, HEIGHT))
pygame.display.set_caption("Corrida Circular")
clock = pygame.time.Clock()
FPS = 60

# Cores
GREEN = (0, 200, 0)
GRAY = (100, 100, 100)
WHITE = (255, 255, 255)
RED = (255, 0, 0)

# Carro
car_img = pygame.Surface((40, 20), pygame.SRCALPHA)
pygame.draw.polygon(car_img, RED, [(0, 0), (40, 10), (0, 20)])

# Estado do carro
car_pos = [WIDTH // 2, HEIGHT // 2 - 150]
car_angle = 0  # graus
car_speed = 0
acceleration = 0.1
max_speed = 5
friction = 0.05
turn_speed = 3  # graus por frame

# Função para desenhar circuito oval
def draw_track():
    pygame.draw.circle(screen, GREEN, (WIDTH // 2, HEIGHT // 2), 200)
    pygame.draw.circle(screen, GRAY, (WIDTH // 2, HEIGHT // 2), 150)
    pygame.draw.circle(screen, GREEN, (WIDTH // 2, HEIGHT // 2), 100)

# Função para rotacionar imagem
def blit_rotate_center(surf, image, pos, angle):
    rotated_image = pygame.transform.rotate(image, -angle)
    new_rect = rotated_image.get_rect(center=image.get_rect(topleft=pos).center)
    surf.blit(rotated_image, new_rect.topleft)

# Loop principal
running = True
while running:
    clock.tick(FPS)
    screen.fill(WHITE)

    # Eventos
    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            running = False

    # Entradas
    keys = pygame.key.get_pressed()
    if keys[pygame.K_UP]:
        car_speed += acceleration
    if keys[pygame.K_DOWN]:
        car_speed -= acceleration
    if keys[pygame.K_LEFT]:
        car_angle += turn_speed
    if keys[pygame.K_RIGHT]:
        car_angle -= turn_speed

    # Limita a velocidade
    car_speed = max(-max_speed, min(max_speed, car_speed))

    # Aplica atrito
    if car_speed > 0:
        car_speed -= friction
        if car_speed < 0:
            car_speed = 0
    elif car_speed < 0:
        car_speed += friction
        if car_speed > 0:
            car_speed = 0

    # Atualiza posição
    radians = math.radians(car_angle)
    car_pos[0] += math.cos(radians) * car_speed
    car_pos[1] += math.sin(radians) * car_speed

    # Desenho da pista e do carro
    draw_track()
    blit_rotate_center(screen, car_img, car_pos, car_angle)

    pygame.display.flip()

pygame.quit()
