import pygame
import math

# Inicialização
pygame.init()

# Tela
WIDTH, HEIGHT = 1536, 1024
screen = pygame.display.set_mode((WIDTH, HEIGHT))
pygame.display.set_caption("Insper Racers")
clock = pygame.time.Clock()
FPS = 60
#jnj
# Cores
GREEN = (0, 200, 0)
GRAY = (100, 100, 100)
WHITE = (255, 255, 255)
RED = (255, 0, 0)

# Carro
# car_img = pygame.Surface((40, 20), pygame.SRCALPHA)
# pygame.draw.polygon(car_img, RED, [(0, 0), (40, 10), (0, 20)])
car_img = pygame.Surface((40, 20), pygame.SRCALPHA)
car_img = pygame.image.load(r"carro.png")
car_img = pygame.transform.scale(car_img, (60, 30))
# Estado do carro
car_pos = [WIDTH // 2, HEIGHT // 2 - 150]
car_angle = 0  # graus
car_speed = 0
acceleration = 0.4
max_speed = 4.5
friction = 0.05
turn_speed = 2  # graus por frame

# Carro
# car_img = pygame.Surface((40, 20), pygame.SRCALPHA)
# pygame.draw.polygon(car_img, RED, [(0, 0), (40, 10), (0, 20)])
car_img2 = pygame.Surface((40, 20), pygame.SRCALPHA)
car_img2 = pygame.image.load(r"carro2.png")
car_img2 = pygame.transform.scale(car_img2, (78, 39))
# Estado do carro
car_pos2 = [WIDTH // 2, HEIGHT // 2 - 150]
car_angle2 = 0  # graus
car_speed2 = 0
acceleration2 = 0.4
max_speed2 = 4.5
friction2 = 0.05
turn_speed2 = 2  # graus por frame

# Função para desenhar circuito oval
def draw_track():
    image = pygame.image.load(r'Pista.png').convert()
    image = pygame.transform.scale(image, (WIDTH, HEIGHT))
    screen.fill((0, 0, 0))  # Preenche com a cor branca
    screen.blit(image, (10, 10))
    

# Função para rotacionar imagem
def blit_rotate_center(surf, image, pos, angle):
    rotated_image = pygame.transform.rotate(image, -angle)
    new_rect = rotated_image.get_rect(center=image.get_rect(topleft=pos).center)
    surf.blit(rotated_image, new_rect.topleft)

# Loop principal
running = True
while running:
    clock.tick(FPS)
    screen.fill(WHITE)

    # Eventos
    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            running = False

    # Entradas
    keys = pygame.key.get_pressed()
    if keys[pygame.K_w]:
        car_speed += acceleration
    if keys[pygame.K_s]:
        car_speed -= acceleration
    if keys[pygame.K_d]:
        car_angle += turn_speed
    if keys[pygame.K_a]:
        car_angle -= turn_speed
    if keys[pygame.K_ESCAPE]:
        running=False

    #Jogador 2
    if keys[pygame.K_UP]:
        car_speed2 += acceleration
    if keys[pygame.K_DOWN]:
        car_speed2 -= acceleration
    if keys[pygame.K_RIGHT]:
        car_angle2 += turn_speed
    if keys[pygame.K_LEFT]:
        car_angle2 -= turn_speed
    if keys[pygame.K_ESCAPE]:
        running=False

    # Limita a velocidade
    car_speed = max(-max_speed, min(max_speed, car_speed))
    car_speed2 = max(-max_speed2, min(max_speed2, car_speed2))

    # Aplica atrito
    if car_speed > 0:
        car_speed -= friction
        if car_speed < 0:
            car_speed = 0
    elif car_speed < 0:
        car_speed += friction
        if car_speed > 0:
            car_speed = 0

    # Aplica atrito
    if car_speed2 > 0:
        car_speed2 -= friction
        if car_speed2 < 0:
            car_speed2 = 0
    elif car_speed2 < 0:
        car_speed2 += friction
        if car_speed2 > 0:
            car_speed2 = 0

    # Atualiza posição
    radians = math.radians(car_angle)
    car_pos[0] += math.cos(radians) * car_speed
    car_pos[1] += math.sin(radians) * car_speed
    # Atualiza posição
    radians = math.radians(car_angle2)
    car_pos2[0] += math.cos(radians) * car_speed2
    car_pos2[1] += math.sin(radians) * car_speed2

    # Entradas
    keys = pygame.key.get_pressed()
    if keys[pygame.K_w]:
        car_speed += acceleration
    if keys[pygame.K_s]:
        car_speed -= acceleration
    if keys[pygame.K_d]:
        car_angle += turn_speed
    if keys[pygame.K_a]:
        car_angle -= turn_speed
    if keys[pygame.K_ESCAPE]:
        running=False
        #Jogador 2
    if keys[pygame.K_UP]:
        car_speed2 += acceleration
    if keys[pygame.K_DOWN]:
        car_speed2 -= acceleration
    if keys[pygame.K_RIGHT]:
        car_angle2 += turn_speed
    if keys[pygame.K_LEFT]:
        car_angle2 -= turn_speed
    if keys[pygame.K_ESCAPE]:
        running=False

    # Limita a velocidade
    car_speed = max(-max_speed, min(max_speed, car_speed))
    car_speed2 = max(-max_speed2, min(max_speed2, car_speed2))

    # Aplica atrito
    if car_speed > 0:
        car_speed -= friction
        if car_speed < 0:
            car_speed = 0
    elif car_speed < 0:
        car_speed += friction
        if car_speed > 0:
            car_speed = 0

    # Aplica atrito
    if car_speed2 > 0:
        car_speed2 -= friction
        if car_speed2 < 0:
            car_speed2 = 0
    elif car_speed2 < 0:
        car_speed2 += friction
        if car_speed2 > 0:
            car_speed2 = 0

    # Atualiza posição
    radians = math.radians(car_angle)
    car_pos[0] += math.cos(radians) * car_speed
    car_pos[1] += math.sin(radians) * car_speed
    # Atualiza posição
    radians = math.radians(car_angle2)
    car_pos2[0] += math.cos(radians) * car_speed2
    car_pos2[1] += math.sin(radians) * car_speed2

    # Desenho da pista e do carro
    draw_track()
    blit_rotate_center(screen, car_img, car_pos, car_angle)
    blit_rotate_center(screen, car_img2, car_pos2, car_angle2)

    pygame.display.flip()

pygame.quit()
